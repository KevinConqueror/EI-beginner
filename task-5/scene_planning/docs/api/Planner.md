# class Planner

[Source Code](https://github.com/RoboticSJTU/partnr-planner/blob/habitat_llm/planner/planner.py)

```python
from habitat_llm.planner.planner import Planner
```

## Methods

### process_high_level_actions

```python
def process_high_level_actions(
    self, hl_actions: Dict[int, Tuple[str, str, str]], 
    observations: Dict[str, Any]
) -> Tuple[Dict[int, Any], Dict[int, str]]:
    ...
```

Uses agent tools to process high-level actions into action vectors and responses from the tools.

Parameters:

- hl_actions: A dictionary of high-level actions for each agent.
- observations: The current observations.

Return:

- A dictionary of low-level actions for each agent
- A dictionary of responses for each agent

Note that high-level actions follow a specific format:

```python
{
    agent_id: # Always 0 in this project
        (action_name, action_input, error_message)
}
```

And the `action_input` has different formats depending on the action. `error_message` can be `None`.

See Tutorial 2 for details.

### get_next_action

```python
def get_next_action(
    self,
    instruction: str,
    observations: Dict[str, Any],
    world_graph: Dict[int, WorldGraph],
) -> Tuple[Dict[int, Any], Dict[str, Any], bool]:
```

Gives the next low level action to execute.

Parameter:

- instruction: The instruction for the task.
- observations: The current observations. Key is sensor name. Value is a torch Tensor which uas batch as the first dim. And the batch_size is always 1 in this project.
- world_graph: The world graph for each agent. Key is agent id, which is always `0` in this project. Value is current partial [WorldGraph](WorldGraph.md)

Return

- The low-level actions for each agent. It can be generated by `process_high_level_actions`.
- Planner information
- Whether the planner is done

About the returned planner information.

There information is used mainly for logging. There are some special field which may be helpful for debugging:

- `high_level_actions`: If this field exists, the evaluation script will add the high-level action information as text to the output video. Ensure that the value of this field is a valid high-level action; otherwise, the evaluation script may throw an error.
- `image_text`: If this field exists, the evaluation script will include the text in the output video. This text will be appended after `high_level_actions` if both fields are provided.

The evaluation script may take a small amount of time to process the Planner Information. In most cases, this time is negligible compared to the planning time. If you are concerned about this affecting the evaluation results, you can return `{}` as the Planner Information. Note that you must not return `None`, as this may cause the evaluation script to throw an error.
 
See tutorial 2 for its usage.

### reset

```python
def reset(self) -> None:
    """
    Reset the planner state.
    """
    ...
```

During the evaluation process, the Planner object will not be repeatedly created. After each episode is completed, `Planner.reset` will be called to reset. You need to override this function in your implementation of the Planner to reset and clear any episode-related context.